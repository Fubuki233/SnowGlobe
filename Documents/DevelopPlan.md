# 开发计划

## 第一周计划
python脚本操作方式详见[技术文档](Documents/TechDocs.md)
| 角色 | 计划 |
|------|------|
| zyh | LLM+GOAP工作流，搭建测试场景 |
| myy | 物品模板系统设计(可以被外部python脚本操作,最好可以在游戏运行时注册新物品) |
| mzt | 基础网格系统(现在已有tilemaplayer的网格,现在需要每个网格内的贴图/属性都可以被python脚本操作)|
| 美术 | 手绘几个场景元素 |
| 策划 | 居民属性+计算方法 + 10个物品设计表(最好是类似科技树里面的物品,各自有关联) |

---

## 前期总体计划

## 美术

- 需要确定美术风格,尽量保证简约,特征鲜明
- 手绘最初场景,详见:[项目规划 - 初始环境与居民](Plans.md#初始环境与居民)
- 用SonwWave测试器根据手绘美术素材生成的的场景与物品
- UI 显示状态

## 程序

- 实现动态加载资源,注册物品与实体(不需要很复杂,只是为了为发展核心做测试)
- 发展核心实现:由创造新物品或场景开始
- Godot 场景搭建
- 网格系统
- 回合制逻辑
- 居民属性系统
- 简单 AI（状态机）

### AI 行为系统：GOAP + LLM 

#### 思路

 **GOAP + LLM** ：

- **GOAP** 负责日常行为规划，提供可靠性、速度和可预测性
- **LLM** 仅在遇到新物品/对话获取新信息时介入，动态生成新行动

#### 方案：原子行为组合 + 通用系统

##### 1. 原子行为库

定义游戏引擎提供的基础原子操作：
需要设计大量类似的操作,要足够基础,覆盖面要足够大

```python
    "move_to": 移动到指定位置,
    "pick_up": 拾取物品,
    "drop": 放下物品,
    "use_item": 使用物品,
    "throw": 投掷物体,
    "wait": 等待,
    "play_sound": 播放音效,
    "talk": 与其他npc对话
```


##### 2. LLM 触发机制

当 AI 遇到未知物品/对话获取新信息时

**工作流程**：

1. AI 遇到新物品 → 检查本地缓存，寻找相似物品，尝试复用已有行动定义
2. 如果是新物品 → 触发 LLM
3. LLM 读取物品信息（名称、描述、属性、标签）
4. LLM 生成新行动定义（GOAP Action）
   - 行动名称
   - 前置条件
   - 效果
   - 成本
5. LLM 将高级行动分解为原子行为序列
6. 验证(可能需要专门的验证agent来做这一部分)并注册到 GOAP
7. 缓存结果（本地 + 持久化）

##### 3. 执行层架构

```text
高级行动（LLM 生成）
    ↓
行为映射表
    ↓
原子行为序列 ← 原子操作
    ↓           ↓
  执行器 → 通用系统 → 游戏引擎
```

**示例流程**：

- LLM 生成："DistractEnemy"（用平底锅制造噪音）
- 分解为：
  1. `pick_up("pan")` - 原子操作
  2. `move_to("safe_distance")` - 原子操作  
  3. `throw("pan", "away")` - 原子操作
  4. 触发通用噪音系统 - 播放音效 + 通知附近 AI

GOAP插件:
https://github.com/RodZill4/godot-goap
安装:
https://docs.godotengine.org/zh-cn/4.x/tutorials/plugins/editor/installing_plugins.html
  
## 策划

- 需要确定玩家属性与居民属性,详见:[项目规划 - 玩家属性](Plans.md#玩家属性)
- 需要确定文明发展机制,详见:[项目规划 - 文明发展](Plans.md#文明发展)
- 守护/混沌/暴露值计算机制
- 玩家干预反馈
  